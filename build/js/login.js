"use strict";var sectionLogin=document.querySelector("#section-login"),loginButtonSubmit=sectionLogin.querySelector("#loginButtonSubmit"),loginButtonRegister=sectionLogin.querySelector("#loginButtonRegister"),loginInputLogin=sectionLogin.querySelector("#loginInputLogin"),loginInputPassword=sectionLogin.querySelector("#loginInputPassword"),sectionRegister=document.querySelector("#section-register"),registerButtonSubmit=sectionRegister.querySelector("#registerButtonSubmit"),registerButtonCancel=sectionRegister.querySelector("#registerButtonCancel"),registerInputName=sectionRegister.querySelector("#registerInputName"),registerInputEmail=sectionRegister.querySelector("#registerInputEmail"),registerInputPassword=sectionRegister.querySelector("#registerInputPassword"),registerInputConfirmPassword=sectionRegister.querySelector("#registerInputConfirmPassword"),registerUserAgreement=sectionRegister.querySelector("#registerUserAgreement"),sectionEmailConfirm=document.querySelector("#section-emailConfirm"),emailConfirmButtonSubmit=sectionEmailConfirm.querySelector("#emailConfirmButtonSubmit"),emailConfirmButtonCancel=sectionEmailConfirm.querySelector("#emailConfirmButtonCancel"),showSection=function(e){e.classList.remove("d-none")},hideSection=function(e){e.classList.add("d-none")},testEmail=function(e){return-1!==e.indexOf("@")},getOperatorAndFolderId=function(e){for(var t=e.split("-"),r="",n=0;n<t.length-1;n++)r+=t[n];return{operator:t[t.length-1],folder:r}},getCredentialsId=function(e,t){var r=getOperatorAndFolderId(e);return{url:"https://lopos.bidone.ru/api/v1/lopos_directory/"+r.folder+"/authorization/login",metod:"POST",data:"operator="+r.operator+"&deviceToken=-&password="+t}},getCredentialsEmail=function(e,t){return{url:"https://lopos.bidone.ru/api/v1/user_boss/login",metod:"POST",data:"email="+e+"&deviceToken=-&password="+t}},setStorage=function(e){sessionStorage.setItem("directory",e.data.directory),sessionStorage.setItem("email",e.data.email),sessionStorage.setItem("lastLogin",e.data.lastLogin),sessionStorage.setItem("nickname",e.data.nickname),sessionStorage.setItem("operator_id",e.data.operator_id),sessionStorage.setItem("token",e.data.token)},loadApplication=function(){location="./index.html"},callbackRecquestLoginSuccess=function(e){var t=JSON.parse(e);200==t.status?(setStorage(t),loadApplication()):alert(t.message)};loginButtonSubmit.addEventListener("click",function(){var e,t=loginInputLogin.value,r=loginInputPassword.value;e=testEmail(t)?getCredentialsEmail(t,r):getCredentialsId(t,r),requestToServer(e.url,e.metod,e.data,callbackRecquestLoginSuccess)}),loginButtonRegister.addEventListener("click",function(){hideSection(sectionLogin),showSection(sectionRegister)});var testUserAgreement=function(){return!!registerUserAgreement.checked},testClearPassword=function(){return""!==registerInputPassword.value},testInputPassword=function(){return registerInputPassword.value===registerInputConfirmPassword.value},testInputName=function(){return""!==registerInputName.value},testInputEmail=function(){return""!==registerInputEmail.value},testInput=function(){return testUserAgreement()?testInputName()?testInputEmail()?testClearPassword()?!!testInputPassword()||(alert("Пароли не совпадают"),!1):(alert("Введите пароль"),!1):(alert("Введите действительный email"),!1):(alert("Введите имя пользователя"),!1):(alert("Необходимо принять соглашение пользователя"),!1)},getRegData=function(){return{url:"https://lopos.bidone.ru/api/v1/user_boss/registration",metod:"POST",data:"email="+registerInputEmail.value+"&phone=&password="+registerInputPassword.value+"&nickname="+registerInputName.value+"&prefer_language=ru"}},showConfirmEmail=function(){hideSection(sectionRegister),showSection(sectionEmailConfirm)},callbackRecquestRegisterSuccess=function(e){var t=JSON.parse(e);200==t.status?(sessionStorage.setItem("regMail",registerInputEmail.value),sessionStorage.setItem("regNick",registerInputName.value),showConfirmEmail()):alert(t.message)};registerButtonSubmit.addEventListener("click",function(){if(testInput()){var e=getRegData();requestToServer(e.url,e.metod,e.data,callbackRecquestRegisterSuccess)}}),registerButtonCancel.addEventListener("click",function(){hideSection(sectionRegister),showSection(sectionLogin)});var testClearKey=function(){return""!==emailConfirmInputKey},getConfirmData=function(){return{url:"https://lopos.bidone.ru/api/v1/user_boss/submit_registration",metod:"POST",data:"email="+sessionStorage.getItem("regMail")+"&prefer_language=ru&validate_code="+emailConfirmInputKey.value}},callbackRecquestConfirmSuccess=function(e){var t=JSON.parse(e);200==t.status?(setStorage(t),loadApplication()):alert(t.message)};emailConfirmButtonSubmit.addEventListener("click",function(){if(testClearKey()){var e=getConfirmData();requestToServer(e.url,e.metod,e.data,callbackRecquestConfirmSuccess)}else alert("Введите ключ, полученный по email")}),emailConfirmButtonCancel.addEventListener("click",function(){hideSection(sectionEmailConfirm),showSection(sectionLogin)});